-- Sample 180: Database Creation and Management
-- Category: DDL / Administration
-- Complexity: Complex
-- Purpose: Parser testing - CREATE DATABASE syntax variations
-- Features: Files, filegroups, options, contained databases

-- Pattern 1: Basic database creation
CREATE DATABASE SimpleDB;
GO
DROP DATABASE SimpleDB;
GO

-- Pattern 2: Database with file specification
CREATE DATABASE FileDB
ON PRIMARY (
    NAME = FileDB_Data,
    FILENAME = 'C:\Data\FileDB.mdf',
    SIZE = 100MB,
    MAXSIZE = 1GB,
    FILEGROWTH = 50MB
)
LOG ON (
    NAME = FileDB_Log,
    FILENAME = 'C:\Data\FileDB.ldf',
    SIZE = 50MB,
    MAXSIZE = 500MB,
    FILEGROWTH = 25MB
);
GO
DROP DATABASE FileDB;
GO

-- Pattern 3: Database with multiple data files
CREATE DATABASE MultiFileDB
ON PRIMARY (
    NAME = MultiFileDB_Primary,
    FILENAME = 'C:\Data\MultiFileDB_Primary.mdf',
    SIZE = 100MB
),
(
    NAME = MultiFileDB_Data2,
    FILENAME = 'C:\Data\MultiFileDB_Data2.ndf',
    SIZE = 100MB
),
(
    NAME = MultiFileDB_Data3,
    FILENAME = 'C:\Data\MultiFileDB_Data3.ndf',
    SIZE = 100MB
)
LOG ON (
    NAME = MultiFileDB_Log,
    FILENAME = 'C:\Data\MultiFileDB_Log.ldf',
    SIZE = 50MB
);
GO
DROP DATABASE MultiFileDB;
GO

-- Pattern 4: Database with filegroups
CREATE DATABASE FilegroupDB
ON PRIMARY (
    NAME = FilegroupDB_Primary,
    FILENAME = 'C:\Data\FilegroupDB_Primary.mdf',
    SIZE = 50MB
),
FILEGROUP HistoryFG (
    NAME = FilegroupDB_History1,
    FILENAME = 'C:\Data\FilegroupDB_History1.ndf',
    SIZE = 100MB
),
(
    NAME = FilegroupDB_History2,
    FILENAME = 'C:\Data\FilegroupDB_History2.ndf',
    SIZE = 100MB
),
FILEGROUP ArchiveFG (
    NAME = FilegroupDB_Archive,
    FILENAME = 'C:\Data\FilegroupDB_Archive.ndf',
    SIZE = 200MB
)
LOG ON (
    NAME = FilegroupDB_Log,
    FILENAME = 'C:\Data\FilegroupDB_Log.ldf',
    SIZE = 50MB
);
GO
DROP DATABASE FilegroupDB;
GO

-- Pattern 5: Database with collation
CREATE DATABASE CollatedDB
COLLATE Latin1_General_CI_AS;
GO
DROP DATABASE CollatedDB;
GO

-- Pattern 6: Database with containment
CREATE DATABASE ContainedDB
CONTAINMENT = PARTIAL;
GO
DROP DATABASE ContainedDB;
GO

-- Pattern 7: Database for attach
CREATE DATABASE AttachedDB
ON (FILENAME = 'C:\Data\ExistingDB.mdf')
FOR ATTACH;
GO
DROP DATABASE AttachedDB;
GO

-- Pattern 8: Database for attach with multiple files
CREATE DATABASE AttachedMultiDB
ON (FILENAME = 'C:\Data\ExistingDB.mdf'),
   (FILENAME = 'C:\Data\ExistingDB_Log.ldf')
FOR ATTACH;
GO

-- Pattern 9: Database for attach rebuild log
CREATE DATABASE RebuildLogDB
ON (FILENAME = 'C:\Data\ExistingDB.mdf')
FOR ATTACH_REBUILD_LOG;
GO

-- Pattern 10: Database as copy (Azure SQL)
CREATE DATABASE CopyDB
AS COPY OF SourceDB;
GO

-- Pattern 11: Database from snapshot
CREATE DATABASE RecoveredDB
FROM DATABASE_SNAPSHOT = 'SourceDB_Snapshot';
GO

-- Pattern 12: Database snapshot
CREATE DATABASE SnapshotDB
ON (
    NAME = SourceDB_Data,
    FILENAME = 'C:\Data\SourceDB_Snapshot.ss'
)
AS SNAPSHOT OF SourceDB;
GO
DROP DATABASE SnapshotDB;
GO

-- Pattern 13: ALTER DATABASE - options
ALTER DATABASE MyDB SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
ALTER DATABASE MyDB SET MULTI_USER;
ALTER DATABASE MyDB SET READ_ONLY;
ALTER DATABASE MyDB SET READ_WRITE;
ALTER DATABASE MyDB SET OFFLINE;
ALTER DATABASE MyDB SET ONLINE;
ALTER DATABASE MyDB SET EMERGENCY;
ALTER DATABASE MyDB SET RESTRICTED_USER;
GO

-- Pattern 14: ALTER DATABASE - recovery model
ALTER DATABASE MyDB SET RECOVERY SIMPLE;
ALTER DATABASE MyDB SET RECOVERY FULL;
ALTER DATABASE MyDB SET RECOVERY BULK_LOGGED;
GO

-- Pattern 15: ALTER DATABASE - compatibility level
ALTER DATABASE MyDB SET COMPATIBILITY_LEVEL = 160;  -- SQL 2022
ALTER DATABASE MyDB SET COMPATIBILITY_LEVEL = 150;  -- SQL 2019
ALTER DATABASE MyDB SET COMPATIBILITY_LEVEL = 140;  -- SQL 2017
ALTER DATABASE MyDB SET COMPATIBILITY_LEVEL = 130;  -- SQL 2016
GO

-- Pattern 16: ALTER DATABASE - Query Store
ALTER DATABASE MyDB SET QUERY_STORE = ON;
ALTER DATABASE MyDB SET QUERY_STORE = OFF;
ALTER DATABASE MyDB SET QUERY_STORE CLEAR;

ALTER DATABASE MyDB SET QUERY_STORE (
    OPERATION_MODE = READ_WRITE,
    CLEANUP_POLICY = (STALE_QUERY_THRESHOLD_DAYS = 30),
    DATA_FLUSH_INTERVAL_SECONDS = 900,
    MAX_STORAGE_SIZE_MB = 1024,
    INTERVAL_LENGTH_MINUTES = 60,
    SIZE_BASED_CLEANUP_MODE = AUTO,
    QUERY_CAPTURE_MODE = ALL
);
GO

-- Pattern 17: ALTER DATABASE - files
ALTER DATABASE MyDB ADD FILE (
    NAME = MyDB_Data2,
    FILENAME = 'C:\Data\MyDB_Data2.ndf',
    SIZE = 100MB
);

ALTER DATABASE MyDB ADD LOG FILE (
    NAME = MyDB_Log2,
    FILENAME = 'C:\Data\MyDB_Log2.ldf',
    SIZE = 50MB
);

ALTER DATABASE MyDB MODIFY FILE (
    NAME = MyDB_Data,
    SIZE = 200MB
);

ALTER DATABASE MyDB REMOVE FILE MyDB_Data2;
GO

-- Pattern 18: ALTER DATABASE - filegroups
ALTER DATABASE MyDB ADD FILEGROUP NewFG;
ALTER DATABASE MyDB ADD FILEGROUP MemoryOptimizedFG CONTAINS MEMORY_OPTIMIZED_DATA;
ALTER DATABASE MyDB MODIFY FILEGROUP NewFG DEFAULT;
ALTER DATABASE MyDB MODIFY FILEGROUP NewFG READ_ONLY;
ALTER DATABASE MyDB MODIFY FILEGROUP NewFG READ_WRITE;
ALTER DATABASE MyDB REMOVE FILEGROUP NewFG;
GO

-- Pattern 19: ALTER DATABASE - collation
ALTER DATABASE MyDB COLLATE SQL_Latin1_General_CP1_CI_AS;
GO

-- Pattern 20: ALTER DATABASE - rename
ALTER DATABASE MyDB MODIFY NAME = RenamedDB;
GO

-- Pattern 21: ALTER DATABASE - auto options
ALTER DATABASE MyDB SET AUTO_CLOSE OFF;
ALTER DATABASE MyDB SET AUTO_SHRINK OFF;
ALTER DATABASE MyDB SET AUTO_CREATE_STATISTICS ON;
ALTER DATABASE MyDB SET AUTO_UPDATE_STATISTICS ON;
ALTER DATABASE MyDB SET AUTO_UPDATE_STATISTICS_ASYNC ON;
GO

-- Pattern 22: ALTER DATABASE - cursor options
ALTER DATABASE MyDB SET CURSOR_CLOSE_ON_COMMIT OFF;
ALTER DATABASE MyDB SET CURSOR_DEFAULT LOCAL;
ALTER DATABASE MyDB SET CURSOR_DEFAULT GLOBAL;
GO

-- Pattern 23: ALTER DATABASE - ANSI options
ALTER DATABASE MyDB SET ANSI_NULL_DEFAULT OFF;
ALTER DATABASE MyDB SET ANSI_NULLS ON;
ALTER DATABASE MyDB SET ANSI_PADDING ON;
ALTER DATABASE MyDB SET ANSI_WARNINGS ON;
ALTER DATABASE MyDB SET ARITHABORT ON;
ALTER DATABASE MyDB SET CONCAT_NULL_YIELDS_NULL ON;
ALTER DATABASE MyDB SET NUMERIC_ROUNDABORT OFF;
ALTER DATABASE MyDB SET QUOTED_IDENTIFIER ON;
ALTER DATABASE MyDB SET RECURSIVE_TRIGGERS OFF;
GO

-- Pattern 24: ALTER DATABASE - parameterization
ALTER DATABASE MyDB SET PARAMETERIZATION SIMPLE;
ALTER DATABASE MyDB SET PARAMETERIZATION FORCED;
GO

-- Pattern 25: ALTER DATABASE - snapshot isolation
ALTER DATABASE MyDB SET ALLOW_SNAPSHOT_ISOLATION ON;
ALTER DATABASE MyDB SET READ_COMMITTED_SNAPSHOT ON;
GO

-- Pattern 26: ALTER DATABASE - change tracking
ALTER DATABASE MyDB SET CHANGE_TRACKING = ON
    (CHANGE_RETENTION = 2 DAYS, AUTO_CLEANUP = ON);
ALTER DATABASE MyDB SET CHANGE_TRACKING = OFF;
GO

-- Pattern 27: ALTER DATABASE - encryption
ALTER DATABASE MyDB SET ENCRYPTION ON;
ALTER DATABASE MyDB SET ENCRYPTION OFF;
GO

-- Pattern 28: ALTER DATABASE - broker
ALTER DATABASE MyDB SET ENABLE_BROKER;
ALTER DATABASE MyDB SET DISABLE_BROKER;
ALTER DATABASE MyDB SET NEW_BROKER;
GO

-- Pattern 29: DROP DATABASE
DROP DATABASE IF EXISTS MyDB;
DROP DATABASE MyDB, AnotherDB;  -- Multiple databases
GO

-- Pattern 30: Database scoped configuration
ALTER DATABASE SCOPED CONFIGURATION SET MAXDOP = 4;
ALTER DATABASE SCOPED CONFIGURATION SET LEGACY_CARDINALITY_ESTIMATION = OFF;
ALTER DATABASE SCOPED CONFIGURATION SET PARAMETER_SNIFFING = ON;
ALTER DATABASE SCOPED CONFIGURATION SET QUERY_OPTIMIZER_HOTFIXES = OFF;
ALTER DATABASE SCOPED CONFIGURATION CLEAR PROCEDURE_CACHE;
GO
